<h1>Organizer</h1>

<div><%= link_to 'profile', user_path(current_user.id) %></div>
<div><%= link_to 'sign out', destroy_user_session_path, method: :delete %></div>

<div>
  <%= form_with url: root_url, method: :get do |form| %>
    <%= form.label :search_query, "Search for organization:" %>
    <%= form.text_field :search_query %>
    <%= form.submit "Search" %>
  <% end %>
</div>


<% if @organizations_by_name %>
  <% @organizations_by_name.each do |organization| %>
    <div>
      <h5><%= link_to organization.name, organization_path(organization.id) %></h5>
    </div>
  <% end %>
<% end %>

<% if @organizations_by_services_hash %>
  <% @organizations_by_services_hash.keys.each do |organization| %>
    <div>
        <h5><%= link_to organization.name, organization_path(organization.id) %></h5>
        Services:
        <% @organizations_by_services_hash[organization].each do |service| %>
          <b><%= service.name %></b>
        <% end %>
    </div>
  <% end %>
<% end %>


<div>
  <% if current_user.admin? %>
    <p>Last client reservations:</p>
    <% Reservation.order(:updated_at).limit(40).each do |reservation| %>
      <div class="row">
      <div class="col s12 m4 l1">
        <ul>
          <li>User id: <%= reservation.user_id %></li>
          <li>Organization: <%= reservation.time_slot.organization_service.organization.name %></li>
          <li>Service: <%= reservation.time_slot.organization_service.service.name %></li>
          <li>Start time: <%= reservation.time_slot.start_time.in_time_zone('Minsk') %></li>
          <li>End time: <%= reservation.time_slot.end_time.in_time_zone('Minsk') %></li>
          <li><%= button_to 'delete', reservation_path(reservation.id), method: :delete %></li>
        </ul>
      </div>
      </div>
    <% end %>
  <% else %>
    <p>Your active reservations:</p>
    <% current_user.reservations.each do |reservation| %>
      <div class="row">
      <div class="col s12 m4 l4">
        <ul>
          <li>Organization: <%= reservation.time_slot.organization_service.organization.name %></li>
          <li>Service: <%= reservation.time_slot.organization_service.service.name %></li>
          <li>Start time: <%= reservation.time_slot.start_time.in_time_zone('Minsk') %></li>
          <li>End time: <%= reservation.time_slot.end_time.in_time_zone('Minsk') %></li>
          <li><%= button_to 'delete', reservation_path(reservation.id), method: :delete %></li>
        </ul>
      </div>
      </div>
    <% end %>
  <% end %>
</div>

